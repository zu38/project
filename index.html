<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schedule Management System</title>
    <!-- External libraries for export to PDF and Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        h1 {
            text-align: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        table, th, td {
            border: 1px solid #ddd;
        }

        th, td {
            padding: 8px;
            text-align: center;
        }

        .form-container {
            margin-bottom: 20px;
        }

        .form-container select,
        .form-container input {
            margin: 5px;
            padding: 8px;
        }

        .btn {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }

        .btn:hover {
            background-color: #45a049;
        }

        .error {
            color: red;
            font-size: 14px;
        }
    </style>
</head>

<body>

    <h1>Schedule Management System</h1>

    <div class="form-container">
        <label for="teacherSelect">Teacher:</label>
        <select id="teacherSelect">
            <!-- Teacher options should be populated here -->
        </select>

        <label for="subject">Subject:</label>
        <input type="text" id="subject" placeholder="Enter subject">

        <label for="semester">Semester:</label>
        <select id="semester">
            <option value="1">One</option>
            <option value="2">Two</option>
            <option value="3">Three</option>
            <option value="4">Four</option>
            <option value="5">Five</option>
            <option value="6">Six</option>
            <option value="7">Seven</option>
            <option value="8">Eight</option>
        </select>

        <label for="day">Day:</label>
        <select id="day">
            <option value="sunday">Sunday</option>
            <option value="monday">Monday</option>
            <option value="tuesday">Tuesday</option>
            <option value="wednesday">Wednesday</option>
            <option value="thursday">Thursday</option>
        </select>

        <label for="startTime">Start Time:</label>
        <input type="time" id="startTime">

        <label for="endTime">End Time:</label>
        <input type="time" id="endTime">

        <button class="btn" onclick="addSchedule()">Add Schedule</button>
    </div>

    <h2>Schedule</h2>
    <table id="scheduleTable">
        <thead>
            <tr>
                <th>Teacher</th>
                <th>Subject</th>
                <th>Semester</th>
                <th>Day</th>
                <th>Start Time</th>
                <th>End Time</th>
            </tr>
        </thead>
        <tbody>
            <!-- Schedules will be displayed here -->
        </tbody>
    </table>

    <button class="btn" onclick="exportToPDF()">Export to PDF</button>
    <button class="btn" onclick="exportToExcel()">Export to Excel</button>

    <script>
        let teachers = JSON.parse(localStorage.getItem('teachers')) || ['Teacher 1', 'Teacher 2', 'Teacher 3']; // Example teachers
        let schedules = JSON.parse(localStorage.getItem('schedules')) || [];

        // Function to populate teacher select options
        function populateTeachers() {
            const teacherSelect = document.getElementById('teacherSelect');
            teachers.forEach((teacher, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = teacher;
                teacherSelect.appendChild(option);
            });
        }

        // Display the schedules in the table
        function displaySchedules() {
            const scheduleTableBody = document.getElementById('scheduleTable').getElementsByTagName('tbody')[0];
            scheduleTableBody.innerHTML = '';
            schedules.forEach(schedule => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${teachers[schedule.teacherId]}</td>
                    <td>${schedule.subject}</td>
                    <td>${schedule.semester}</td>
                    <td>${schedule.day}</td>
                    <td>${schedule.startTime}</td>
                    <td>${schedule.endTime}</td>
                `;
                scheduleTableBody.appendChild(row);
            });
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('teachers', JSON.stringify(teachers));
            localStorage.setItem('schedules', JSON.stringify(schedules));
        }

        // Export to PDF
        function exportToPDF() {
            const doc = new jspdf.jsPDF();
            doc.autoTable({
                head: [['Teacher', 'Subject', 'Semester', 'Day', 'Start Time', 'End Time']],
                body: schedules.map(s => [
                    teachers[s.teacherId],
                    s.subject,
                    s.semester,
                    s.day,
                    s.startTime,
                    s.endTime
                ]),
            });
            doc.save('schedule.pdf');
        }

        // Export to Excel
        function exportToExcel() {
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(schedules.map(s => ({
                Teacher: teachers[s.teacherId],
                Subject: s.subject,
                Semester: s.semester,
                Day: s.day,
                'Start Time': s.startTime,
                'End Time': s.endTime
            })));
            XLSX.utils.book_append_sheet(wb, ws, 'Schedule');
            XLSX.writeFile(wb, 'schedule.xlsx');
        }

        // Add schedule to the system
        function addSchedule() {
            const teacherId = document.getElementById('teacherSelect').value;
            const subject = document.getElementById('subject').value.trim();
            const semester = document.getElementById('semester').value;
            const day = document.getElementById('day').value;
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;

            if (!teacherId || !subject || !semester || !day || !startTime || !endTime) {
                alert("⚠️ Please fill all fields properly.");
                return;
            }

            if (startTime >= endTime) {
                alert("⚠️ Start time must be before end time.");
                return;
            }

            // Time and Teacher Overlap Check for Same Semester
            const overlap = schedules.some(s =>
                s.semester === semester && // Check for the same semester
                s.day.toLowerCase() === day.toLowerCase() && // Check for the same day
                (
                    (startTime >= s.startTime && startTime < s.endTime) || // New class starts during an existing class
                    (endTime > s.startTime && endTime <= s.endTime) || // New class ends during an existing class
                    (startTime <= s.startTime && endTime >= s.endTime) // New class fully overlaps an existing class
                )
            );

            if (overlap) {
                alert("❌ Time Overlap! Another class is scheduled at the same time for this semester.");
                return;
            }

            // Add the schedule if no overlap
            schedules.push({ teacherId, subject, semester, day, startTime, endTime });
            saveData();
            displaySchedules();

            // Reset form fields
            document.getElementById('teacherSelect').value = '';
            document.getElementById('subject').value = '';
            document.getElementById('semester').value = '';
            document.getElementById('day').value = '';
            document.getElementById('startTime').value = '';
            document.getElementById('endTime').value = '';
        }

        // Initialize the page
        populateTeachers();
        displaySchedules();
    </script>

</body>

</html>
